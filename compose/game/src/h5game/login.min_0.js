var __reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),ListButton=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.dataChanged=function(){if(null==this.dataInfo&&(this.width=199,this.height=60,this.img=new eui.Image("resource/login/xuanfutanchuang5.png"),this.addChild(this.img),this.label=new eui.Label,this.label.width=165,this.label.y=19,this.label.textColor=14857728,this.label.size=24,this.label.textAlign=egret.HorizontalAlign.CENTER,this.label.touchEnabled=!1,this.addChild(this.label)),this.dataInfo=this.data,this.dataInfo.selection?this.img.source="resource/login/xuanfutanchuang4.png":this.img.source="resource/login/xuanfutanchuang5.png",0==this.dataInfo.index)this.label.text=this.dataInfo.lab;else{var e=this.dataInfo.serAry.length;this.label.text=this.dataInfo.serAry[e-1].ID+"-"+this.dataInfo.serAry[0].ID+"区"}},t}(eui.ItemRenderer);__reflect(ListButton.prototype,"ListButton");var Main=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.openId="",t.getType=0,t.serverlist=[],t.myLoginList=[],t.selectIdx=0,t.serverAry=[],t.typeAry=["resource/login/fwq_sc.png","resource/login/fwq_hb.png","resource/login/fwq_wh.png"],t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),t.init=this,egret.Capabilities.isMobile&&-1==navigator.userAgent.indexOf("iPad")||(this.stage.scaleMode=egret.StageScaleMode.SHOW_ALL,this.stage.orientation=egret.OrientationMode.AUTO),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.group=new eui.Group,this.group.width=580,this.group.height=930,this.stage.addChild(this.group);var i=new eui.Image("resource/login/loaded.jpg");this.group.addChild(i),this.groupLogin=new eui.Group,this.groupLogin.width=580,this.groupLogin.height=200,this.groupLogin.horizontalCenter=0,this.groupLogin.bottom=141,this.group.addChild(this.groupLogin),this.servGroup=new eui.Group,this.groupLogin.addChild(this.servGroup);var r=new eui.Image("resource/login/serbg.png");r.x=65,r.y=7;var s=new eui.Image("resource/login/serbg.png");s.x=511,s.y=7,s.scaleX=-1,this.servGroup.addChild(r),this.servGroup.addChild(s),this.typeIcon=new eui.Image("resource/login/fwq_hb.png"),this.typeIcon.x=122,this.typeIcon.y=17,this.servGroup.addChild(this.typeIcon),this.serviceLabel=new eui.Label,this.serviceLabel.x=168,this.serviceLabel.y=19,this.serviceLabel.textColor=14857728,this.serviceLabel.text="",this.servGroup.addChild(this.serviceLabel),this.clickLabel=new eui.Label,this.clickLabel.x=345,this.clickLabel.y=19,this.clickLabel.textColor=56833,this.clickLabel.textFlow=new Array({text:"点击换区",style:{underline:!0}}),this.clickLabel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLabelClick,this),this.servGroup.addChild(this.clickLabel),this.img4=new eui.Image("resource/login/btn_kaishi.png"),this.img4.x=135,this.img4.y=67,this.servGroup.addChild(this.img4),this.img4.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onButtonClick,this),this.loadingGroup=new eui.Group,this.loadingGroup.width=533,this.loadingGroup.visible=!1,this.loadingGroup.horizontalCenter=0,this.groupLogin.addChild(this.loadingGroup);var n=new eui.Image("resource/login/jiazaitiao1.png");n.x=24,n.y=9,n.width=488,this.loadingGroup.addChild(n),t.rect=new eui.Rect(488,19,1312e3),t.rect.y=9,t.rect.right=21,this.loadingGroup.addChild(t.rect);var o=new eui.Image("resource/login/jiazaitiao.png");if(o.width=533,o.scale9Grid=new egret.Rectangle(37,13,2,11),this.loadingGroup.addChild(o),t.img3=new eui.Image("resource/login/jiazaitiaotx.png"),t.img3.y=-7,t.img3.x=-5,this.loadingGroup.addChild(t.img3),t.label=new eui.Label,t.label.size=20,t.label.textColor=56833,t.label.y=-18,t.label.horizontalCenter=.5,t.label.text="(正在加载主程序)",this.loadingGroup.addChild(t.label),0==window.loginType){this.editableText=new eui.EditableText,this.editableText.width=205,this.editableText.height=40,this.editableText.text="haohaiyao",this.editableText.size=30,this.editableText.anchorOffsetY=0,this.editableText.anchorOffsetX=0,this.editableText.textAlign="center",this.editableText.horizontalCenter=.5,this.editableText.bottom=410,this.editableText.maxChars=30;var l=egret.localStorage.getItem("userName");null!=l&&""!=l&&(this.editableText.text=l),this.group.addChild(this.editableText),this.onLabelClick(1)}else this.img5=new eui.Image("resource/login/btn_kaishi.png"),this.img5.x=135,this.img5.y=67,this.groupLogin.addChild(this.img5),this.img5.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onButtonLoginClick,this),this.img5.visible=!1,window.Login();this.servGroup.visible=!1},t.prototype.onLabelClick=function(e){this.getType=0,1==e&&(this.getType=e);var t=new egret.HttpRequest;t.responseType=egret.HttpResponseType.TEXT,t.addEventListener(egret.Event.COMPLETE,this.getServiceComp,this),t.addEventListener(egret.IOErrorEvent.IO_ERROR,this.getServiceErr,this),0==window.loginType?t.open(window.serviceListdUrl+"?account="+this.editableText.text,egret.HttpMethod.GET):t.open(window.serviceListdUrl+"?account="+this.openId,egret.HttpMethod.GET),t.send(),this.clickLabel.touchEnabled=!1},t.prototype.setServer=function(){var e=new egret.HttpRequest;e.responseType=egret.HttpResponseType.TEXT,0==window.loginType?e.open(window.setServiceListdUrl+"?account="+this.editableText.text+"&srvid="+this.selectSerInfo.ID,egret.HttpMethod.GET):e.open(window.setServiceListdUrl+"?account="+this.openId+"&srvid="+this.selectSerInfo.ID,egret.HttpMethod.GET),e.send()},t.prototype.getServiceComp=function(e){var t=e.target;if(this.clickLabel.touchEnabled=!0,this.servGroup.visible=!0,null==t.response||0==t.response||""==t.response)return void alert("暂无服务器！");for(var i=JSON.parse(t.response),r=[],s=[],n=[],o=i.serverlist.length,l=0;o>l;l++)window.pf==i.serverlist[l].pf&&(r.push(i.serverlist[l]),i.login&&i.login.length>0&&-1!=i.login.indexOf(i.serverlist[l].ID+"")&&(n[i.serverlist[l].ID+""]=i.serverlist[l]));if(i.login&&i.login.length>0)for(var l=0;l<i.login.length;l++)n[i.login[l]]&&s.push(n[i.login[l]]);return 0==r.length?void alert("暂无服务器！"):void(0==this.getType?this.createServiceView({serAry:r,loginAry:s}):s.length>0?this.onClickList2({item:s[0]}):this.onClickList2({item:r[r.length-1]}))},t.prototype.createServiceView=function(e){if(null==this.createServiceGroup){this.serviceRect=new eui.Rect(580,930,0),this.serviceRect.alpha=.3,this.group.addChild(this.serviceRect),this.createServiceGroup=new eui.Group,this.createServiceGroup.width=547,this.createServiceGroup.height=753,this.createServiceGroup.horizontalCenter=0,this.createServiceGroup.verticalCenter=0,this.group.addChild(this.createServiceGroup);var t=new eui.Image("resource/login/xuanfutanchuang.png");t.scale9Grid=new egret.Rectangle(206,72,26,26),t.width=547,t.height=753,this.createServiceGroup.addChild(t);var i=new eui.Label("选择区服");i.x=221,i.y=20,i.size=26,i.textColor=14857728,this.createServiceGroup.addChild(i);var r=new eui.Image("resource/login/xuanfutanchuang3.png");r.scale9Grid=new egret.Rectangle(11,14,4,3),r.width=193,r.height=611,r.x=35,r.y=75,this.createServiceGroup.addChild(r);var s=new eui.Image("resource/login/xuanfutanchuang3.png");s.scale9Grid=new egret.Rectangle(11,14,4,3),s.width=267,s.height=611,s.x=245,s.y=75,this.createServiceGroup.addChild(s),this.scroller=new eui.Scroller,this.scroller.width=209,this.scroller.height=598,this.scroller.x=37,this.scroller.y=81,this.createServiceGroup.addChild(this.scroller),this.list=new eui.List,this.list.itemRenderer=ListButton;var n=new eui.VerticalLayout;n.gap=7,n.paddingTop=8,n.paddingLeft=10,this.list.layout=n,this.scroller.viewport=this.list,this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onClickScrollCellHandler,this),this.scroller2=new eui.Scroller,this.scroller2.width=255,this.scroller2.height=598,this.scroller2.x=252,this.scroller2.y=80,this.createServiceGroup.addChild(this.scroller2),this.list2=new eui.List,this.list2.itemRenderer=ServiceItem;var n=new eui.VerticalLayout;n.gap=5,n.paddingTop=8,n.paddingLeft=5,this.list2.layout=n,this.scroller2.viewport=this.list2,this.list2.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onClickList2,this);var t=new eui.Image("resource/login/chatclose.png");t.x=473,t.y=10,t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeFuncton,this),this.createServiceGroup.addChild(t);var t=new eui.Image("resource/login/fwq_sc.png");t.x=94,t.y=702,this.createServiceGroup.addChild(t);var t=new eui.Image("resource/login/fwq_wh.png");t.x=227,t.y=702,this.createServiceGroup.addChild(t);var t=new eui.Image("resource/login/fwq_hb.png");t.x=357,t.y=702,this.createServiceGroup.addChild(t);var o=new eui.Label("顺畅");o.textColor=2424576,o.x=144,o.y=709,o.size=22,this.createServiceGroup.addChild(o);var o=new eui.Label("维护");o.textColor=12303291,o.x=276,o.y=709,o.size=22,this.createServiceGroup.addChild(o);var o=new eui.Label("爆满");o.textColor=16733184,o.x=408,o.y=709,o.size=22,this.createServiceGroup.addChild(o)}this.createServiceGroup.visible=!0,this.serviceRect.visible=!0,this.serverlist=e.serAry,this.serverAry=[];for(var l=this.serverlist.length,h=0,a=0;l>a;a++)h=Math.floor(a/100),null==this.serverAry[h]&&(this.serverAry[h]={serAry:[]}),this.serverAry[h].serAry.push(this.serverlist[a]);this.serverAry=this.serverAry.reverse(),this.serverAry.unshift({index:-1,lab:"最近登录",serAry:e.loginAry}),l=this.serverAry.length;for(var a=0;l>a;a++)this.serverAry[a].index=a,a>0&&(this.serverAry[a].serAry=this.serverAry[a].serAry.reverse());this.serverAry[1].selection=!0,this.dataArray=new eui.ArrayCollection(this.serverAry),this.list.dataProvider=this.dataArray,this.selectIdx=1,this.onClickScrollCellHandler({item:this.serverAry[1]})},t.prototype.getServiceErr=function(){this.clickLabel.touchEnabled=!0},t.prototype.closeFuncton=function(){this.createServiceGroup&&(this.createServiceGroup.visible=!1,this.serviceRect.visible=!1),this.clickLabel.touchEnabled=!0},t.prototype.onClickScrollCellHandler=function(e){this.serverAry[this.selectIdx]&&(this.serverAry[this.selectIdx].selection=!1),this.selectIdx=e.item.index,this.serverAry[this.selectIdx]&&(this.serverAry[this.selectIdx].selection=!0),this.dataArray.replaceAll(this.serverAry),this.list2.dataProvider=new eui.ArrayCollection(e.item.serAry)},t.prototype.onClickList2=function(e){this.closeFuncton(),this.selectSerInfo=e.item,this.selectSerInfo&&(this.serviceLabel.text=this.selectSerInfo.srvname,this.typeIcon.source=this.typeAry[this.selectSerInfo.status])},t.prototype.openWin=function(e){if(null!=e&&""!=e){this.winLabel||(this.winLabel=new eui.Label,this.winLabel.size=30,this.winLabel.textColor=56833),egret.Tween.removeTweens(this.winLabel),this.winLabel.x=212,this.winLabel.y=452,this.winLabel.text=e,this.winLabel.alpha=1,this.group.addChild(this.winLabel);var t=egret.Tween.get(this.winLabel);t.to({y:350},800).to({alpha:0},100)}},t.prototype.onButtonClick=function(){if(null==this.selectSerInfo)return void this.openWin("请选择服务器！");if(0==window.loginType){if(""==this.editableText.text)return void this.openWin("非法登陆！")}else if(""==this.openId)return void this.openWin("非法登陆！");if(2==this.selectSerInfo.status)return void this.openWin("维护中！");var e=new egret.HttpRequest;e.responseType=egret.HttpResponseType.TEXT,e.addEventListener(egret.Event.COMPLETE,this.compHttp,this),e.addEventListener(egret.IOErrorEvent.IO_ERROR,this.errHttp,this);0==window.loginType?e.open(this.selectSerInfo.url+"?account="+this.editableText.text+"&passwd=123456",egret.HttpMethod.GET):e.open(this.selectSerInfo.url+"?account="+this.openId+"&passwd=123456",egret.HttpMethod.GET),e.send(),this.img4.touchEnabled=!1},t.prototype.compHttp=function(e){var t=e.target;if(null==t.response||""==t.response||"100"==t.response||100==t.response)this.openWin("帐号创建失败！"),this.img4.touchEnabled=!0;else{this.setServer(),this.servGroup.visible=!1,this.loadingGroup.visible=!0;var i="?srvaddr="+this.selectSerInfo.ip+"&srvid="+this.selectSerInfo.index+"&serverid="+this.selectSerInfo.index+"&srvname="+this.selectSerInfo.srvname+"&srvport="+this.selectSerInfo.port+"&user=";0==window.loginType?(this.editableText.visible=!1,egret.localStorage.setItem("userName",this.editableText.text),window.start(i+this.editableText.text)):window.start(i+this.openId)}},t.prototype.errHttp=function(e){this.openWin("服务器连接失败！"),this.img4.touchEnabled=!0},t.showLoadProgress=function(e,i){t.rect.width=(100-Number(e))/100*488,t.img3.x=Number(e)/100*488-35,t.label.text=""+i},t.prototype.LoginFunction=function(e){return this.openId=e.openId,this.openId&&""!=this.openId&&null!=this.openId?(this.img5&&(this.img5.visible=!1),void this.onLabelClick(1)):void this.openWin("非法登陆！")},t.prototype.showLoginButton=function(){this.img5.visible=!0},t.prototype.onButtonLoginClick=function(){window.onClickLogin()},t}(eui.UILayer);__reflect(Main.prototype,"Main");var ServiceItem=function(e){function t(){var t=e.call(this)||this;return t.typeAry=["resource/login/fwq_sc.png","resource/login/fwq_hb.png","resource/login/fwq_wh.png"],t}return __extends(t,e),t.prototype.dataChanged=function(){null==this.dataInfo&&(this.width=244,this.height=62,this.img=new eui.Image("resource/login/xuanfutanchuang2.png"),this.img.scale9Grid=new egret.Rectangle(8,7,51,48),this.img.width=300,this.addChild(this.img),this.imgtype=new eui.Image,this.imgtype.x=42,this.imgtype.y=16,this.addChild(this.imgtype),this.label=new eui.Label,this.label.x=99,this.label.y=18,this.label.size=24,this.label.touchEnabled=!1,this.label.textColor=14857728,this.addChild(this.label)),this.dataInfo=this.data,this.imgtype.source=this.typeAry[this.dataInfo.status],this.label.text=this.dataInfo.srvname},t}(eui.ItemRenderer);__reflect(ServiceItem.prototype,"ServiceItem");